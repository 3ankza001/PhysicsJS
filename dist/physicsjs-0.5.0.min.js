(function(t,e){"object"==typeof exports?module.exports=e.call(t):"function"==typeof define&&define.amd?define(function(){return e.call(t)}):t.Physics=e.call(t)})(this,function(){"use strict";var t=function t(){return t.world.apply(t,arguments)};t.util={},function(e){function n(){}function r(t,e,n,r){function o(){var r=arguments,h=a?this:e;if(i||(t=e[c]),n.length&&(r=r.length?(r=J.call(r),u?r.concat(n):n.concat(r)):n),this instanceof o){s.prototype=t.prototype,h=new s,s.prototype=null;var f=t.apply(h,r);return l(f)?f:h}return t.apply(h,r)}var i=h(t),a=!n,c=e;if(a){var u=r;n=e}else if(!i){if(!r)throw new TypeError;e=t}return o}function o(){for(var t,e={shadowedProps:x,arrays:"isArray(iterable)",bottom:"",init:"iterable",loop:"",top:"",useHas:!0,useKeys:!!te},r=0;t=arguments[r];r++)for(var o in t)e[o]=t[o];var i=e.args;e.firstArg=/^[^,]+/.exec(i)[0];var s=Function("hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectTypes","return function("+i+") {\n"+Q(e)+"\n}");return s(z,a,c,f,te,n,F)}function i(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function s(){}function a(t){return L.call(t)==A}function c(t){return G.argsObject&&t instanceof Array||(D?D(t):L.call(t)==j)}function u(t,e,r,o,s,c){var l=r===w;if("function"==typeof r&&!l){r=n.createCallback(r,o,2);var f=r(t,e);if(f!==undefined)return!!f}if(t===e)return 0!==t||1/t==1/e;var p=typeof t,d=typeof e;if(t===t&&(!t||"function"!=p&&"object"!=p)&&(!e||"function"!=d&&"object"!=d))return!1;if(null==t||null==e)return t===e;var v=L.call(t),g=L.call(e);if(v==A&&(v=M),g==A&&(g=M),v!=g)return!1;switch(v){case k:case P:return+t==+e;case I:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case O:case q:return t==e+""}var _=v==j;if(!_){if(z.call(t,"__wrapped__ ")||z.call(e,"__wrapped__"))return u(t.__wrapped__||t,e.__wrapped__||e,r,o,s,c);if(v!=M||!G.nodeClass&&(i(t)||i(e)))return!1;var b=!G.argsObject&&a(t)?Object:t.constructor,y=!G.argsObject&&a(e)?Object:e.constructor;if(b!=y&&!(h(b)&&b instanceof b&&h(y)&&y instanceof y))return!1}s||(s=[]),c||(c=[]);for(var m=s.length;m--;)if(s[m]==t)return c[m]==e;var x=0;if(f=!0,s.push(t),c.push(e),_){if(m=t.length,x=e.length,f=x==t.length,!f&&!l)return f;for(;x--;){var S=m,F=e[x];if(l)for(;S--&&!(f=u(t[S],F,r,o,s,c)););else if(!(f=u(t[x],F,r,o,s,c)))break}return f}return re(e,function(e,n,i){return z.call(i,n)?(x++,f=z.call(t,n)&&u(t[n],e,r,o,s,c)):undefined}),f&&!l&&re(t,function(t,e,n){return z.call(n,e)?f=--x>-1:undefined}),f}function h(t){return"function"==typeof t}function l(t){return t?F[typeof t]:!1}function f(t){return"string"==typeof t||L.call(t)==q}function p(t,e,n){if(e&&n===undefined&&c(t))for(var r=-1,o=t.length;o>++r&&e(t[r],r,t)!==!1;);else ee(t,e,n);return t}function d(t){var e=-1,n=t?t.length:0,r=Array("number"==typeof n?n:0);return p(t,function(t){var n=B(N()*(++e+1));r[e]=r[n],r[n]=t}),r}function v(t,e,r,o){var i=0,s=t?t.length:i;for(r=r?n.createCallback(r,o,1):y,e=r(e);s>i;){var a=i+s>>>1;e>r(t[a])?i=a+1:s=a}return i}function g(t,e){return G.fastBind||W&&arguments.length>2?W.call.apply(W,arguments):r(t,e,J.call(arguments,2))}function _(t,e,n){if(null==t)return y;var r=typeof t;if("function"!=r){if("object"!=r)return function(e){return e[t]};var o=te(t);return function(e){for(var n=o.length,r=!1;n--&&(r=u(e[o[n]],t[o[n]],w)););return r}}return e!==undefined?1===n?function(n){return t.call(e,n)}:2===n?function(n,r){return t.call(e,n,r)}:4===n?function(n,r,o,i){return t.call(e,n,r,o,i)}:function(n,r,o){return t.call(e,n,r,o)}:t}function b(t,e,n){function r(){c=new Date,a=null,h&&(i=t.apply(s,o))}var o,i,s,a,c=0,u=!0,h=!0;return n===!1?u=!1:n&&F[typeof n]&&(u="leading"in n?n.leading:u,h="trailing"in n?n.trailing:h),function(){var n=new Date;a||u||(c=n);var h=e-(n-c);return o=arguments,s=this,0>=h?(R(a),a=null,c=n,i=t.apply(s,o)):a||(a=H(r,h)),i}}function y(t){return t}var m="object"==typeof global&&global;(m.global===m||m.window===m)&&(e=m);var w={};+new Date+"";var x=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],A="[object Arguments]",j="[object Array]",k="[object Boolean]",P="[object Date]",S="[object Function]",I="[object Number]",M="[object Object]",O="[object RegExp]",q="[object String]",F={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},E=[],C={};e._;var T=RegExp("^"+(C.valueOf+"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),R=(Math.ceil,e.clearTimeout),B=(E.concat,Math.floor),z=C.hasOwnProperty,H=(E.push,e.setTimeout),L=C.toString,W=T.test(W=L.bind)&&W,D=T.test(D=Array.isArray)&&D,V=(e.isFinite,e.isNaN,T.test(V=Object.keys)&&V),N=(Math.max,Math.min,Math.random),J=E.slice,$=T.test(e.attachEvent),K=W&&!/\n|true/.test(W+$),G=n.support={};(function(){var t=function(){this.x=1},e=[];t.prototype={valueOf:1,y:1};for(var n in new t)e.push(n);for(n in arguments);G.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),G.argsClass=a(arguments),G.enumPrototypes=t.propertyIsEnumerable("prototype"),G.fastBind=W&&!K,G.nonEnumArgs=0!=n,G.nonEnumShadows=!/valueOf/.test(e),G.unindexedChars="xx"!="x"[0]+Object("x")[0];try{G.nodeClass=!(L.call(document)==M&&!({toString:0}+""))}catch(r){G.nodeClass=!0}})(1);var Q=function(t){var e="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";\n";if(t.arrays?(e+="var length = iterable.length; index = -1;\nif ("+t.arrays+") {  ",G.unindexedChars&&(e+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),e+="\n  while (++index < length) {\n    "+t.loop+"\n  }\n}\nelse {  "):G.nonEnumArgs&&(e+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+"\n    }\n  } else {  "),G.enumPrototypes&&(e+="\n  var skipProto = typeof iterable == 'function';\n  "),t.useHas&&t.useKeys)e+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] ? keys(iterable) : [],\n      length = ownProps.length;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n    ",G.enumPrototypes&&(e+="if (!(skipProto && index == 'prototype')) {\n  "),e+=t.loop,G.enumPrototypes&&(e+="}\n"),e+="  }  ";else if(e+="\n  for (index in iterable) {",(G.enumPrototypes||t.useHas)&&(e+="\n    if (",G.enumPrototypes&&(e+="!(skipProto && index == 'prototype')"),G.enumPrototypes&&t.useHas&&(e+=" && "),t.useHas&&(e+="hasOwnProperty.call(iterable, index)"),e+=") {    "),e+=t.loop+";    ",(G.enumPrototypes||t.useHas)&&(e+="\n    }"),e+="\n  }    ",G.nonEnumShadows){e+="\n\n  var ctor = iterable.constructor;\n      ";for(var n=0;7>n;n++)e+="\n  index = '"+t.shadowedProps[n]+"';\n  if (","constructor"==t.shadowedProps[n]&&(e+="!(ctor && ctor.prototype === iterable) && "),e+="hasOwnProperty.call(iterable, index)) {\n    "+t.loop+"\n  }      "}return(t.arrays||G.nonEnumArgs)&&(e+="\n}"),e+=t.bottom+";\nreturn result"},U={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},X={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",arrays:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},Y={top:"if (!objectTypes[typeof iterable]) return result;\n"+X.top,arrays:!1};G.argsClass||(a=function(t){return t?z.call(t,"callee"):!1});var Z=o({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)",arrays:!1}),te=V?function(t){return l(t)?G.enumPrototypes&&"function"==typeof t||G.nonEnumArgs&&t.length&&a(t)?Z(t):V(t):[]}:Z,ee=o(X),ne=o(U,{top:U.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),re=o(X,Y,{useHas:!1}),oe=o(X,Y);h(/x/)&&(h=function(t){return t instanceof Function||L.call(t)==S}),n.assign=ne,n.bind=g,n.createCallback=_,n.forEach=p,n.forIn=re,n.forOwn=oe,n.keys=te,n.shuffle=d,n.throttle=b,n.each=p,n.extend=ne,n.identity=y,n.isArguments=a,n.isArray=c,n.isEqual=u,n.isFunction=h,n.isObject=l,n.isString=f,n.sortedIndex=v,n.VERSION="1.2.0",n.extend(t.util,n)}(this);var e=t.util.decorator=function e(e,n){var r={},o={},i=function i(e,n){return t.util.isFunction(n)?n:e},s=Object.getPrototypeOf;"function"!=typeof s&&(s="object"==typeof"test".__proto__?function(t){return t.__proto__}:function(t){return t.constructor.prototype});var a=Object.create;"function"!=typeof a&&(a=function(t){function e(){}return e.prototype=t,new e});var c=function c(n,r){return"object"==typeof n?(o=t.util.extend(o,n,i),o.type=e,void 0):("type"!==n&&t.util.isFunction(r)&&(o[n]=r),void 0)};c(n);var u=function u(n,c,u,h){var l,f=o;if("string"!=typeof c)h=u,u=c;else{if(f=r[c],!f)throw'Error: "'+c+'" '+e+" not defined";f=f.prototype}if("function"==typeof u)l=r[n],l?l.prototype=t.util.extend(l.prototype,u(s(l.prototype)),i):(l=r[n]=function(t){this.init&&this.init(t)},l.prototype=a(f),l.prototype=t.util.extend(l.prototype,u(f),i)),l.prototype.type=e,l.prototype.name=n;else if(h=u||{},l=r[n],!l)throw'Error: "'+n+'" '+e+" not defined";return h?new l(h):void 0};return u.mixin=c,u};return function(e){var n;n=e&&e.console&&e.console.log?function(){e.console.log.apply(e,arguments)}:function(){},t.util.log=n}(this),function(t){for(var e=0,n=["ms","moz","webkit","o"],r=0;n.length>r&&!t.requestAnimationFrame;++r)t.requestAnimationFrame=t[n[r]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[n[r]+"CancelAnimationFrame"]||t[n[r]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(n){var r=(new Date).getTime(),o=Math.max(0,16-(r-e)),i=t.setTimeout(function(){n(r+o)},o);return e=r+o,i}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}(this),function(){var e=100,n=10,r="Error: Scratchpad used after .done() called. (Could it be unintentionally scoped?)",o="Error: Scratchpad usage space out of bounds. (Did you forget to call .done()?)",i="Error: Too many scratchpads created. (Did you forget to call .done()?)",s=[],a=0,c=function c(){if(this.objIndex=0,this.arrayIndex=0,this.vectorIndex=0,this.transformIndex=0,this.objectStack=[],this.arrayStack=[],this.vectorStack=[],this.transformStack=[],++a>=e)throw i};c.prototype={done:function(){this._active=!1,this.objIndex=this.arrayIndex=this.vectorIndex=this.transformIndex=0,s.push(this)},object:function(){var t=this.objectStack;if(!this._active)throw r;if(this.objIndex>=n)throw o;return t[this.objIndex++]||t[t.push({})-1]},array:function(){var t=this.arrayStack;if(!this._active)throw r;if(this.arrIndex>=n)throw o;return t[this.arrIndex++]||t[t.push([])-1]},vector:function(){var e=this.vectorStack;if(!this._active)throw r;if(this.vectorIndex>=n)throw o;return e[this.vectorIndex++]||e[e.push(t.vector())-1]},transform:function(){var e=this.transformStack;if(!this._active)throw r;if(this.transformIndex>=n)throw o;return e[this.transformIndex++]||e[e.push(t.transform())-1]}},t.scratchpad=function(){var t=s.pop()||new c;return t._active=!0,t}}(),function(e){function n(t){var r=h;if(u){e.requestAnimationFrame(n);for(var o=0,i=r.length;i>o;++o)r[o](t,t-c);c=t}}function r(){return c=(new Date).getTime(),u=!0,n(),this}function o(){return u=!1,this}function i(t){if("function"==typeof t){for(var e=0,n=h.length;n>e;++e)if(t===h[e])return this;h.push(t)}return this}function s(t){for(var e=h,n=0,r=e.length;r>n;++n)if(e[n]===t)return e.splice(n,1),this;return this}function a(){return!!u}var c=0,u=!1,h=[];t.util.ticker={start:r,stop:o,subscribe:i,unsubscribe:s,isActive:a}}(this),function(){var e=function e(n,r,o,i){return this instanceof e?(this._pos=t.vector(),this.set(n,r,o,i),void 0):new e(n,r,o,i)};e.prototype.set=function(e,n,r,o){return t.util.isObject(e)?(this._pos.clone(e.pos),this._hw=e.halfWidth,this._hh=e.halfHeight,this):(this._pos.set(.5*(r+e),.5*(o+n)),this._hw=.5*(r-e),this._hh=.5*(o-n),this)},e.prototype.get=function(){var t=this.halfWidth(),e=this.halfHeight();return{pos:this._pos.values(),halfWidth:t,halfHeight:e,x:t,y:e}},e.prototype.halfWidth=function(){return this._hw},e.prototype.halfHeight=function(){return this._hh},e.prototype.contains=function(t){return t.get(0)>this._pos.get(0)-this._hw&&t.get(0)<this._pos.get(0)+this._hw&&t.get(1)>this._pos.get(1)-this._hh&&t.get(1)<this._pos.get(1)+this._hh},e.prototype.transform=function(e){var n=this._hw,r=this._hh,o=t.scratchpad(),i=o.vector().set(n,r),s=o.vector().set(n,-r);return this._pos.translate(e),i.rotate(e),s.rotate(e),this._hw=Math.max(Math.abs(i.get(0)),Math.abs(s.get(0))),this._hh=Math.max(Math.abs(i.get(1)),Math.abs(s.get(1))),o.done(),this},t.aabb=e}(),function(){var e=1e-4,n=100,r=function r(t,e,n){var r=e.normSq()-e.dot(t),o=e.dot(t)-t.normSq();return 0>r?n.clone(e).negate():o>0?n.clone(t).negate():(n.clone(e).vsub(t),n.perp(0>t.cross(n)))},o=function o(e){var n,r,o=e.length,i=e[o-2],s=e[o-3],a=t.scratchpad(),c=a.vector().clone(i.pt),u=a.vector().clone(s.pt).vsub(c);if(u.equals(t.vector.zero))return a.done(),{a:i.a,b:i.b};if(n=-u.dot(c)/u.normSq(),r=1-n,0>=r)return a.done(),{a:s.a,b:s.b};if(0>=n)return a.done(),{a:i.a,b:i.b};var h={a:c.clone(i.a).mult(r).vadd(u.clone(s.a).mult(n)).values(),b:c.clone(i.b).mult(r).vadd(u.clone(s.b).mult(n)).values()};return a.done(),h},i=function i(i,s,a,c){var u,h,l,f,p=!1,d=!1,v=!1,g=[],_=1,b=t.scratchpad(),y=b.vector().clone(s||t.vector.axis[0]),m=b.vector(),w=b.vector(),x=b.vector(),A=b.vector(),j=0;for(f=i(y),_=g.push(f),m.clone(f.pt),y.negate();++j;){if(m.swap(w),f=i(y),_=g.push(f),m.clone(f.pt),c&&c(g),m.equals(t.vector.zero)){p=!0;break}if(!d&&0>=m.dot(y)){if(a)break;d=!0}if(2===_)y=r(m,w,y);else if(d){if(y.normalize(),f=w.dot(y),e>Math.abs(f-m.dot(y))){v=-f;break}w.normSq()<x.clone(g[0].pt).normSq()?g.shift():g.splice(1,1),y=r(x.clone(g[1].pt),A.clone(g[0].pt),y)}else if(u=u||b.vector(),h=h||b.vector(),u.clone(w).vsub(m),h.clone(g[0].pt).vsub(m),l=u.cross(h)>0,l^m.cross(u)>0)g.shift(),u.perp(l),y.swap(u);else{if(!(l^h.cross(m)>0)){p=!0;break}g.splice(1,1),h.perp(!l),y.swap(u)}if(j>n)return b.done(),{simplex:g,iterations:j,distance:0,maxIterationsReached:!0}}return b.done(),f={overlap:p,simplex:g,iterations:j},v!==!1&&(f.distance=v,f.closest=o(g)),f};t.gjk=i}(),function(){var e=function e(n,r){return this instanceof e?(this.v=t.vector(),this.angle=0,n instanceof e&&this.clone(n),n&&this.setTranslation(n),this.setRotation(r||0),void 0):new e(n,r)};e.prototype.setTranslation=function(t){return this.v.clone(t),this},e.prototype.setRotation=function(t){return this.angle=0,this.cosA=Math.cos(t),this.sinA=Math.sin(t),this},e.prototype.clone=function(t){return t?(this.setTranslation(t.v),this.setRotation(t.angle),this):new e(this)},t.transform=e}(),function(e){var n=Math.sqrt,r=Math.min,o=Math.max,i=(Math.acos,Math.atan2),s=2*Math.PI,a=!!e.Float64Array,c=function c(t,e){return this instanceof c?(this._=a?new Float64Array(5):[],t&&(void 0!==t.x||t._&&t._.length)?this.clone(t):(this.recalc=!0,this.set(t||0,e||0)),void 0):new c(t,e)};c.prototype.set=function(t,e){return this.recalc=!0,this._[0]=t||0,this._[1]=e||0,this},c.prototype.get=function(t){return this._[t]},c.prototype.vadd=function(t){return this.recalc=!0,this._[0]+=t._[0],this._[1]+=t._[1],this},c.prototype.vsub=function(t){return this.recalc=!0,this._[0]-=t._[0],this._[1]-=t._[1],this},c.prototype.add=function(t,e){return this.recalc=!0,this._[0]+=t,this._[1]+=void 0===e?t:e,this},c.prototype.sub=function(t,e){return this.recalc=!0,this._[0]-=t,this._[1]-=void 0===e?t:e,this},c.prototype.mult=function(t){return this.recalc||(this._[4]*=t*t,this._[3]*=t),this._[0]*=t,this._[1]*=t,this},c.prototype.dot=function(t){return this._[0]*t._[0]+this._[1]*t._[1]},c.prototype.cross=function(t){return-this._[0]*t._[1]+this._[1]*t._[0]},c.prototype.proj=function(t){return this.dot(t)/t.norm()},c.prototype.vproj=function(t){var e=this.dot(t)/t.normSq();return this.clone(t).mult(e)},c.prototype.angle=function(t){var e=i(this._[1],this._[0]);for(t&&(e-=i(t._[1],t._[0]));e>Math.PI;)e-=s;for(;-Math.PI>e;)e+=s;return e},c.prototype.norm=function(){return this.recalc&&(this.recalc=!1,this._[4]=this._[0]*this._[0]+this._[1]*this._[1],this._[3]=n(this._[4])),this._[3]},c.prototype.normSq=function(){return this.recalc&&(this.recalc=!1,this._[4]=this._[0]*this._[0]+this._[1]*this._[1],this._[3]=n(this._[4])),this._[4]},c.prototype.dist=function(t){var e,r;return n((e=t._[0]-this._[0])*e+(r=t._[1]-this._[1])*r)},c.prototype.distSq=function(t){var e,n;return(e=t._[0]-this._[0])*e+(n=t._[1]-this._[1])*n},c.prototype.perp=function(t){var e=this._[0];return t?(this._[0]=-this._[1],this._[1]=e):(this._[0]=this._[1],this._[1]=-e),this},c.prototype.normalize=function(){var t=this.norm();return 0===t?this:(this._[0]/=t,this._[1]/=t,this._[3]=1,this._[4]=1,this)},c.prototype.transform=function(t){return this.set(this._[0]*t.cosA-this._[1]*t.sinA+t.v._[0],this._[0]*t.sinA+this._[1]*t.cosA+t.v._[1])},c.prototype.transformInv=function(t){return this.set(this._[0]*t.cosA+this._[1]*t.sinA-t.v._[0],-this._[0]*t.sinA+this._[1]*t.cosA-t.v._[1])},c.prototype.rotate=function(t){return this.set(this._[0]*t.cosA-this._[1]*t.sinA,this._[0]*t.sinA+this._[1]*t.cosA)},c.prototype.rotateInv=function(t){return this.set(this._[0]*t.cosA+this._[1]*t.sinA,-this._[0]*t.sinA+this._[1]*t.cosA)},c.prototype.translate=function(t){return this.vadd(t.v)},c.prototype.translateInv=function(t){return this.vsub(t.v)},c.prototype.clone=function(t){return t?t._?(this.recalc=t.recalc,t.recalc||(this._[3]=t._[3],this._[4]=t._[4]),this._[0]=t._[0],this._[1]=t._[1],this):this.set(t.x,t.y):new c(this)},c.prototype.swap=function(t){var e=this._;return this._=t._,t._=e,e=this.recalc,this.recalc=t.recalc,t.recalc=e,this},c.prototype.values=function(){return{x:this._[0],y:this._[1]}},c.prototype.zero=function(){return this._[3]=0,this._[4]=0,this._[0]=0,this._[1]=0,this},c.prototype.negate=function(t){return void 0!==t?(this._[t]=-this._[t],this):(this._[0]=-this._[0],this._[1]=-this._[1],this)},c.prototype.clamp=function(t,e){return this._[0]=r(o(this._[0],t._[0]),e._[0]),this._[1]=r(o(this._[1],t._[1]),e._[1]),this.recalc=!0,this},c.prototype.toString=function(){return"("+this._[0]+", "+this._[1]+")"},c.prototype.equals=function(t){return this._[0]===t._[0]&&this._[1]===t._[1]&&this._[2]===t._[2]},c.vadd=function(t,e){return new c(t._[0]+e._[0],t._[1]+e._[1])},c.vsub=function(t,e){return new c(t._[0]-e._[0],t._[1]-e._[1])},c.mult=function(t,e){return new c(e._[0]*t,e._[1]*t)},c.vproj=function(t,e){return c.mult(t.dot(e)/e.normSq(),e)},c.axis=[new c(1,0),new c(0,1)],c.zero=new c(0,0),t.vector=c}(this),function(){t.behavior=t.behaviour=e("behavior",{priority:0,init:function(){},behave:function(){throw"The behavior.behave() method must be overriden"}})}(),function(){t.body=e("body",{init:function(e){var n=t.vector;if(this.fixed=e.fixed||!1,this.mass=e.mass||1,this.restitution=e.restitution||1,this.cof=e.cof||.8,this.moi=0,this.view=null,this.state={pos:n(e.x,e.y),vel:n(e.vx,e.vy),acc:n(),angular:{pos:e.angle||0,vel:e.angularVelocity||0,acc:0},old:{pos:n(),vel:n(),acc:n(),angular:{pos:0,vel:0,acc:0}}},0===this.mass)throw"Error: Bodies must have non-zero mass";this.geometry=t.geometry("point")},accelerate:function(t){return this.state.acc.vadd(t),this},applyForce:function(e,n){var r,o=t.scratchpad(),i=o.vector();return n?this.moi&&(r=this.state,i.clone(n),this.state.angular.acc-=i.cross(e)/this.moi,this.applyForce(e)):this.accelerate(i.clone(e).mult(1/this.mass)),o.done(),this},aabb:function(){var e=t.scratchpad(),n=e.transform(),r=this.state.angular.pos,o=t.aabb(this.geometry.aabb(r));return n.setRotation(0).setTranslation(this.state.pos),o.transform(n),e.done(),o.get()},recalc:function(){}})}(),function(){t.geometry=e("geometry",{init:function(){this._aabb=new t.aabb},aabb:function(){return this._aabb.get()},getFarthestHullPoint:function(e,n){return n=n||t.vector(),n.set(0,0)},getFarthestCorePoint:function(e,n){return n=n||t.vector(),n.set(0,0)}})}(),t.geometry.isPolygonConvex=function(e){var n=t.scratchpad(),r=n.vector(),o=n.vector(),i=n.vector(),s=!0,a=!1,c=e.length;if(3>c)return n.done(),s;r.clone(e[0]).vsub(i.clone(e[c-1]));for(var u=1;c>=u;++u){if(o.clone(e[u%c]).vsub(i.clone(e[(u-1)%c])),a===!1)a=r.cross(o);else if(a>0^r.cross(o)>0){s=!1;break}o.swap(r)}return n.done(),s},t.geometry.getPolygonMOI=function(e){var n,r=t.scratchpad(),o=r.vector(),i=r.vector(),s=0,a=0,c=e.length;if(2>c)return r.done(),0;if(2===c)return n=i.clone(e[1]).distSq(o.clone(e[0])),r.done(),n/12;o.clone(e[0]);for(var u=1;c>u;++u)i.clone(e[u]),n=Math.abs(i.cross(o)),s+=n*(i.normSq()+i.dot(o)+o.normSq()),a+=n,o.swap(i);return r.done(),s/(6*a)},t.geometry.isPointInPolygon=function(e,n){var r=t.scratchpad(),o=r.vector().clone(e),i=r.vector(),s=r.vector(),a=0,c=n.length;if(2>c)return a=o.equals(i.clone(n[0])),r.done(),a;if(2===c)return a=o.angle(i.clone(n[0])),a+=o.angle(i.clone(n[1])),r.done(),Math.abs(a)===Math.PI;i.clone(n[0]).vsub(o);for(var u=1;c>=u;++u)s.clone(n[u%c]).vsub(o),a+=s.angle(i),i.swap(s);return r.done(),Math.abs(a)>0},t.geometry.getPolygonArea=function(e){var n=t.scratchpad(),r=n.vector(),o=n.vector(),i=0,s=e.length;if(3>s)return n.done(),0;r.clone(e[s-1]);for(var a=0;s>a;++a)o.clone(e[a]),i+=r.cross(o),r.swap(o);return n.done(),i/2},t.geometry.getPolygonCentroid=function(e){var n,r=t.scratchpad(),o=r.vector(),i=r.vector(),s=t.vector(),a=e.length;if(2>a)return r.done(),t.vector(e[0]);if(2===a)return r.done(),t.vector((e[1].x+e[0].x)/2,(e[1].y+e[0].y)/2);o.clone(e[a-1]);for(var c=0;a>c;++c)i.clone(e[c]),n=o.cross(i),o.vadd(i).mult(n),s.vadd(o),o.swap(i);return n=1/(6*t.geometry.getPolygonArea(e)),r.done(),s.mult(n)},t.geometry.nearestPointOnLine=function(e,n,r){var o,i,s=t.scratchpad(),a=s.vector().clone(e),c=s.vector().clone(n).vsub(a),u=s.vector().clone(r).vsub(a).vsub(c);return u.equals(t.vector.zero)?(s.done(),t.vector(n)):(o=-u.dot(c)/u.normSq(),i=1-o,0>=i?(s.done(),t.vector(r)):0>=o?(s.done(),t.vector(n)):(a=t.vector(r).mult(o).vadd(c.clone(n).mult(i)),s.done(),a))},function(){var n={drag:0};t.integrator=e("integrator",{init:function(e){this.options=t.util.extend({},n,e)},integrate:function(t,e){var n=this._world;this.integrateVelocities(t,e),n&&n.publish({topic:"integrate:velocities",bodies:t,dt:e}),this.integratePositions(t,e),n&&n.publish({topic:"integrate:positions",bodies:t,dt:e})},integrateVelocities:function(){throw"The integrator.integrateVelocities() method must be overriden"},integratePositions:function(){throw"The integrator.integratePositions() method must be overriden"}})}(),function(){var n={meta:!0,metaRefresh:200,width:600,height:600};t.renderer=e("renderer",{init:function(e){var r="string"==typeof e.el?document.getElementById(e.el):e.el;this.options=t.util.extend({},n,e),this.el=r?r:document.body,this.drawMeta=t.util.throttle(t.util.bind(this.drawMeta,this),this.options.metaRefresh)},render:function(t,e){var n,r;this.beforeRender&&this.beforeRender(),this.options.meta&&this.drawMeta(e);for(var o=0,i=t.length;i>o;++o)n=t[o],r=n.view||(n.view=this.createView(n.geometry)),this.drawBody(n,r)},createView:function(){},drawMeta:function(){},drawBody:function(){}})}(),function(){var e=function(t){this.disconnect&&this._world&&this.disconnect(this._world),this._world=t,this.connect&&t&&this.connect(t)};t.util.each("body,behavior,integrator,renderer".split(","),function(n){t[n].mixin("setWorld",e)});var n="priority",r={name:!1,timestep:6.25,maxSteps:16,webworker:!1,integrator:"verlet"},o=function o(t,e){return this instanceof o?(this.init(t,e),void 0):new o(t,e)};o.prototype={init:function(e,n){t.util.isFunction(e)&&(n=e,e={}),this._stats={fps:0,steps:0},this._bodies=[],this._behaviorStack=[],this._integrator=null,this._renderer=null,this._paused=!1,this._opts={},this._pubsub={},this.options(e||{}),t.util.isFunction(n)&&n.apply(this,[this])},options:function(e){return e?(t.util.extend(this._opts,r,e),this.timeStep(this._opts.timestep),this.add(t.integrator(this._opts.integrator)),this):t.util.extend({},this._opts)},subscribe:function(e,n,r){var o=this._pubsub[e]||(this._pubsub[e]=[]),i=n;return r&&(n=t.util.bind(n,r),n._bindfn_=i),o.push(n),this},unsubscribe:function(t,e){var n,r=this._pubsub[t];if(!r)return this;for(var o=0,i=r.length;i>o;o++)if(n=r[o],n._bindfn_===e||n===e){r.splice(o,1);break}return this},publish:function(t){"object"!=typeof t&&(t={topic:t});var e=t.topic,n=this._pubsub[e];if(!e)throw"Error: No topic specified in call to world.publish()";if(!n||!n.length)return this;t.scope=t.scope||this;for(var r=0,o=n.length;o>r;r++)n[r](t);return this},add:function(t){var e,n=0,r=t&&t.length||0,o=r?t[0]:t;if(!o)return this;do{switch(o.type){case"behavior":this.addBehavior(o);break;case"integrator":this.setIntegrator(o);break;case"renderer":this.addRenderer(o);break;case"body":this.addBody(o);break;default:throw"Error: failed to add item of type "+o.type+" to world"}e={topic:"add:"+o.type},e[o.type]=o,this.publish(e)}while(r>++n&&(o=t[n]));return this},setIntegrator:function(t){this._integrator&&this._integrator.setWorld(null),this._integrator=t,this._integrator.setWorld(this)},addRenderer:function(t){this._renderer&&this._renderer.setWorld(null),this._renderer=t,this._renderer.setWorld(this)},addBehavior:function(e){var r=this._behaviorStack,o=t.util.sortedIndex(r,e,n);return e.setWorld(this),r.splice(o,0,e),this},addBody:function(t){return t.setWorld(this),this._bodies.push(t),this},getBodies:function(){return[].concat(this._bodies)},applyBehaviors:function(t){for(var e,n=this._behaviorStack,r=n.length,o=this._bodies;r--;)e=n[r],e.behave&&e.behave(o,t)},substep:function(t){this._integrator.integrate(this._bodies,t),this.applyBehaviors(t)},step:function(t){if(this._paused)return this._time=!1,this;var e=this._time||(this._time=t),n=t-e,r=this._stats,o=this._dt;if(!n)return this;for(n>this._maxJump&&(this._time=t-this._maxJump,n=this._maxJump),r.fps=1e3/n,r.steps=Math.ceil(n/this._dt);t>this._time;)this._time+=o,this.substep(o);return this},render:function(){if(!this._renderer)throw"No renderer added to world";return this._renderer.render(this._bodies,this._stats),this},pause:function(){return this._paused=!0,this},unpause:function(){return this._paused=!1,this},isPaused:function(){return!!this._paused},timeStep:function(t){return t?(this._dt=t,this._maxJump=t*this._opts.maxSteps,this):this._dt},getByClassName:function(t){for(var e,n=this._bodies,r=[],o=0,i=n.length;i>o;++o)e=n[o],e.hasClass(t)&&r.push(e);return r}},t.world=o}(),t.integrator("verlet",function(e){return t.body.mixin({started:function(t){return void 0!==t&&(this._started=!0),!!this._started}}),{init:function(t){e.init.call(this,t)},integrateVelocities:function(t,e){for(var n,r=e*e,o=1-this.options.drag,i=null,s=0,a=t.length;a>s;++s)i=t[s],n=i.state,i.fixed?(n.vel.zero(),n.acc.zero(),n.angular.vel=0,n.angular.acc=0):(n.vel.equals(n.old.vel)&&i.started()?n.vel.clone(n.pos).vsub(n.old.pos):(n.old.pos.clone(n.pos).vsub(n.vel),n.vel.mult(e)),o&&n.vel.mult(o),n.vel.vadd(n.acc.mult(r)),n.vel.mult(1/e),n.old.vel.clone(n.vel),n.acc.zero(),n.angular.vel===n.old.angular.vel&&i.started()?n.angular.vel=n.angular.pos-n.old.angular.pos:(n.old.angular.pos=n.angular.pos-n.angular.vel,n.angular.vel*=e),n.angular.vel+=n.angular.acc*r,n.angular.vel/=e,n.old.angular.vel=n.angular.vel,n.angular.acc=0,i.started(!0))},integratePositions:function(t,e){for(var n,r=null,o=0,i=t.length;i>o;++o)r=t[o],n=r.state,r.fixed||(n.vel.mult(e),n.old.pos.clone(n.pos),n.pos.vadd(n.vel),n.vel.mult(1/e),n.old.vel.clone(n.vel),n.angular.vel*=e,n.old.angular.pos=n.angular.pos,n.angular.pos+=n.angular.vel,n.angular.vel/=e,n.old.angular.vel=n.angular.vel)}}}),t});